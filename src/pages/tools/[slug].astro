---
import Layout from "../../layouts/Layout.astro";
import data from "../../data/tools.json";
import "@new-ui/foundations";
import { parse } from "node-html-parser";

export function getStaticPaths() {
  const paths: any[] = [];
  
  data.tools.forEach((category: any) => {
    category.content.forEach((tool: any) => {
      if (tool.slug) {
        paths.push({ params: { slug: tool.slug, category: category.category } });
      }
    });
  });
  
  return paths;
}

export const prerender = true;

const { slug } = Astro.params;
const found = data.tools.flatMap((t) => t.content).find((x) => x.slug === slug) || null;

if (!found) {
  // If slug not found, render not-found behaviour (Astro will handle as 404)
  throw new Error(`Tool not found: ${slug}`);
}

const tool = found;
const category = tool.category || 'all';

// helpers
function extractDomain(url: string) {
  try { return new URL(url).hostname.replace('www.', ''); } catch { return '' }
}
function formatDate(dateStr: string) {
  try { return new Date(dateStr).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }); } catch { return dateStr }
}

const domain = extractDomain(tool.url || '');
const formattedDate = formatDate(tool['date-added']);
const canonicalUrl = `https://riseofmachine.com/tools/${tool.slug}`;
const faviconUrl = `https://www.google.com/s2/favicons?sz=128&domain=${domain}`;
const fallbackPath = category === 'all' ? '/' : `/${category}`;

const pageTitle = `${tool.title} - AI Tool | Rise of Machine`;
const pageDescription = `${tool.title}: ${tool.body} | ${tool.tag}`;

type MetadataBlock = {
  basic: {
    title: string | null;
    description: string | null;
    canonicalUrl: string | null;
    favicon: string | null;
  };
  openGraph: {
    title: string | null;
    description: string | null;
    image: string | null;
    type: string | null;
    siteName: string | null;
  };
  brand: {
    author: string | null;
    twitterHandle: string | null;
    emails: string[];
    phones: string[];
    contactUrls: string[];
  };
} | null;

const userAgent = "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36";
const fetchTimeoutMs = 8000;
const maxHtmlBytes = 500_000; // prevent parsing excessively large pages
const metadataCache = new Map<string, Promise<MetadataBlock>>();

const liveMetadata = await fetchExternalMetadata(tool.url || '');

const hasBasicMetadata = Boolean(
  liveMetadata &&
    (liveMetadata.basic.title ||
      liveMetadata.basic.description ||
      liveMetadata.basic.canonicalUrl ||
      liveMetadata.basic.favicon)
);

const hasOpenGraphMetadata = Boolean(
  liveMetadata &&
    (liveMetadata.openGraph.title ||
      liveMetadata.openGraph.description ||
      liveMetadata.openGraph.image ||
      liveMetadata.openGraph.type ||
      liveMetadata.openGraph.siteName)
);

const hasBrandMetadata = Boolean(
  liveMetadata &&
    (liveMetadata.brand.author ||
      liveMetadata.brand.twitterHandle ||
      liveMetadata.brand.emails.length ||
      liveMetadata.brand.phones.length ||
      liveMetadata.brand.contactUrls.length)
);

function normalizeToolUrl(rawUrl: string | undefined | null) {
  if (!rawUrl) return null;
  const trimmed = rawUrl.trim();
  if (!trimmed) return null;

  const candidate = /^[a-zA-Z]+:\/\//.test(trimmed) ? trimmed : `https://${trimmed}`;

  try {
    return new URL(candidate).href;
  } catch {
    return null;
  }
}

async function readResponseWithLimit(response: Response) {
  if (!response.body) {
    return await response.text();
  }

  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  let received = 0;
  let result = "";

  while (true) {
    const { value, done } = await reader.read();
    if (done) break;
    if (!value) continue;

    const remaining = maxHtmlBytes - received;
    if (remaining <= 0) {
      break;
    }

    const chunk = value.byteLength > remaining ? value.slice(0, remaining) : value;
    received += chunk.byteLength;
    result += decoder.decode(chunk, { stream: true });

    if (value.byteLength > remaining) {
      break;
    }
  }

  result += decoder.decode();
  return result;
}

async function fetchExternalMetadata(targetUrl: string): Promise<MetadataBlock> {
  const normalizedUrl = normalizeToolUrl(targetUrl);
  if (!normalizedUrl) return null;

  if (metadataCache.has(normalizedUrl)) {
    return metadataCache.get(normalizedUrl)!;
  }

  const metadataPromise = (async () => {
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), fetchTimeoutMs);

    try {
      const response = await fetch(normalizedUrl, {
        headers: { "User-Agent": userAgent },
        signal: controller.signal,
      });

      if (!response.ok) {
        console.warn(`[metadata] Non-OK response (${response.status}) for ${normalizedUrl}`);
        return null;
      }

      const html = await readResponseWithLimit(response);
      const root = parse(html);
      const baseUrl = new URL(normalizedUrl);

      const pickMetaByName = (name: string) =>
        root.querySelector(`meta[name="${name}"]`)?.getAttribute("content")?.trim() ?? null;

      const pickMetaByProperty = (property: string) =>
        root.querySelector(`meta[property="${property}"]`)?.getAttribute("content")?.trim() ?? null;

      const pickLinkByRel = (rel: string) =>
        root.querySelector(`link[rel="${rel}"]`)?.getAttribute("href")?.trim() ?? null;

      const toAbsolute = (value: string | null) => {
        if (!value) return null;
        try {
          return new URL(value, baseUrl).href;
        } catch {
          return value;
        }
      };

      const unique = <T,>(items: (T | null | undefined)[]) =>
        Array.from(new Set(items.filter(Boolean) as T[]));

      const emailAddresses = unique(
        root.querySelectorAll('a[href^="mailto:"]').map((anchor) =>
          anchor.getAttribute("href")?.replace("mailto:", "").trim() ?? null
        )
      );

      const phoneNumbers = unique(
        root.querySelectorAll('a[href^="tel:"]').map((anchor) =>
          anchor.getAttribute("href")?.replace("tel:", "").trim() ?? null
        )
      );

      const contactUrls = unique(
        root.querySelectorAll("a[href]").map((anchor) => {
          const href = anchor.getAttribute("href") ?? "";
          const text = anchor.text?.toLowerCase() ?? "";
          if (!href) return null;
          const normalizedHref = href.toLowerCase();
          if (
            normalizedHref.includes("contact") ||
            normalizedHref.includes("support") ||
            text.includes("contact") ||
            text.includes("support")
          ) {
            return toAbsolute(href);
          }
          return null;
        })
      ).slice(0, 3);

      const basicTitle =
        root.querySelector("title")?.text?.trim() ??
        pickMetaByProperty("og:title") ??
        pickMetaByName("title") ??
        null;

      return {
        basic: {
          title: basicTitle,
          description: pickMetaByName("description") ?? pickMetaByProperty("og:description"),
          canonicalUrl: toAbsolute(pickLinkByRel("canonical")) ?? normalizedUrl,
          favicon:
            toAbsolute(pickLinkByRel("icon") ?? pickLinkByRel("shortcut icon")) ??
            `https://www.google.com/s2/favicons?sz=128&domain=${baseUrl.hostname}`,
        },
        openGraph: {
          title: pickMetaByProperty("og:title"),
          description: pickMetaByProperty("og:description"),
          image: toAbsolute(pickMetaByProperty("og:image")),
          type: pickMetaByProperty("og:type"),
          siteName: pickMetaByProperty("og:site_name") ?? pickMetaByName("application-name"),
        },
        brand: {
          author: pickMetaByName("author") ?? pickMetaByName("creator"),
          twitterHandle:
            root.querySelector('meta[name="twitter:site"]')?.getAttribute("content")?.trim() ?? null,
          emails: emailAddresses,
          phones: phoneNumbers,
          contactUrls,
        },
      };
    } catch (error) {
      if ((error as Error).name === "AbortError") {
        console.warn(`[metadata] Timed out fetching ${normalizedUrl}`);
      } else {
        console.warn(`[metadata] Failed fetching ${normalizedUrl}: ${(error as Error).message}`);
      }
      return null;
    } finally {
      clearTimeout(timeoutId);
    }
  })();

  metadataCache.set(normalizedUrl, metadataPromise);
  return metadataPromise;
}
---

<Layout site={`Rise of Machine - ${tool.title}`} title={tool.title} tagline={tool.body}>

  <head>
    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription} />
    <link rel="canonical" href={canonicalUrl} />
    <meta property="og:title" content={tool.title} />
    <meta property="og:description" content={tool.body} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:image" content={faviconUrl} />
    <meta name="twitter:card" content="summary_large_image" />
  </head>

  <main>
    <div class="tool-detail-modal-backdrop" id="modalBackdrop">
      <div class="tool-detail-modal" id="toolModal" data-fallback={fallbackPath}>
        <button class="tool-detail-close-btn" id="closeModal" title="Close (Press ESC)" aria-label="Close tool details">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M18 6L6 18M6 6l12 12"/></svg>
        </button>

        <div class="tool-detail-header">
          <div class="tool-icon-container">
            <img src={faviconUrl} alt={`${tool.title} icon`} class="tool-icon" onerror="this.style.display='none'" />
          </div>
          <div class="tool-header-content">
            <h1 class="tool-title">{tool.title}</h1>
            <p class="tool-domain">{domain}</p>
          </div>
        </div>

        <div class="tool-detail-content">
          <section class="tool-summary">
            <p class="tool-description">{tool.body}</p>
            <div class="summary-meta">
              <span class="summary-label">Primary domain</span>
              {tool.url ? (
                <a href={tool.url} target="_blank" rel="noopener noreferrer" class="summary-value">{domain || tool.url}</a>
              ) : (
                <span class="summary-value summary-value--muted">Not provided</span>
              )}
            </div>
          </section>

          <section class="tool-section">
            <header class="section-header">
              <p class="section-eyebrow">Directory data</p>
              <div>
                <h2 class="section-title">Tool snapshot</h2>
                <p class="section-subtitle">Hand-curated fields that we track for every listing.</p>
              </div>
            </header>

            <div class="snapshot-grid">
              <article class="snapshot-card">
                <p class="snapshot-label">Pricing</p>
                <p class="snapshot-value">{tool.tag}</p>
              </article>
              <article class="snapshot-card">
                <p class="snapshot-label">Category</p>
                <a href={category === 'all' ? '/' : `/${category}`} class="snapshot-value category-link">{category}</a>
              </article>
              <article class="snapshot-card">
                <p class="snapshot-label">Added to directory</p>
                <p class="snapshot-value">{formattedDate}</p>
              </article>
              <article class="snapshot-card">
                <p class="snapshot-label">Official site</p>
                {tool.url ? (
                  <a href={tool.url} target="_blank" rel="noopener noreferrer" class="snapshot-value link-muted">{domain || tool.url}</a>
                ) : (
                  <p class="snapshot-value snapshot-value--muted">Not provided</p>
                )}
              </article>
            </div>
          </section>

          <section class="tool-section tool-actions">
            <div class="tool-detail-actions">
              {tool.url ? (
                <a href={tool.url} target="_blank" rel="noopener noreferrer" class="btn-primary">Visit {tool.title}</a>
              ) : (
                <span class="btn-primary btn-disabled" aria-disabled="true">No website listed</span>
              )}
              <p class="action-hint">{tool.url ? 'Opens in a new tab' : 'Add a URL to this listing to enable quick visits.'}</p>
            </div>
          </section>

          {liveMetadata && (
            <section class="tool-section live-section">
              <header class="section-header">
                <p class="section-eyebrow">Fetched from the tool</p>
                <div>
                  <h2 class="section-title">Live site signals</h2>
                  <p class="section-subtitle">We grab metadata once during build to keep this modal instant.</p>
                </div>
              </header>

              <div class="live-metadata-grid">
                {hasBasicMetadata && liveMetadata && (
                  <article class="live-group">
                    <p class="live-group-label">Basic metadata</p>
                    <div class="live-card-grid">
                      {liveMetadata.basic.title && (
                        <div class="live-card">
                          <p class="live-label">Page title</p>
                          <p class="live-value">{liveMetadata.basic.title}</p>
                        </div>
                      )}
                      {liveMetadata.basic.description && (
                        <div class="live-card">
                          <p class="live-label">Description</p>
                          <p class="live-value">{liveMetadata.basic.description}</p>
                        </div>
                      )}
                      {liveMetadata.basic.canonicalUrl && (
                        <div class="live-card">
                          <p class="live-label">Canonical URL</p>
                          <a href={liveMetadata.basic.canonicalUrl} target="_blank" rel="noopener noreferrer" class="live-link">{liveMetadata.basic.canonicalUrl}</a>
                        </div>
                      )}
                      {liveMetadata.basic.favicon && (
                        <div class="live-card live-card-inline">
                          <p class="live-label">Favicon</p>
                          <div class="favicon-preview">
                            <img src={liveMetadata.basic.favicon} alt={`${tool.title} favicon`} loading="lazy" width="32" height="32" />
                            <span>{extractDomain(liveMetadata.basic.canonicalUrl || tool.url || '') || domain}</span>
                          </div>
                        </div>
                      )}
                    </div>
                  </article>
                )}

                {hasOpenGraphMetadata && liveMetadata && (
                  <article class="live-group">
                    <p class="live-group-label">Open Graph & social</p>
                    <div class="live-card-grid">
                      {liveMetadata.openGraph.title && (
                        <div class="live-card">
                          <p class="live-label">OG title</p>
                          <p class="live-value">{liveMetadata.openGraph.title}</p>
                        </div>
                      )}
                      {liveMetadata.openGraph.description && (
                        <div class="live-card">
                          <p class="live-label">OG description</p>
                          <p class="live-value">{liveMetadata.openGraph.description}</p>
                        </div>
                      )}
                      {liveMetadata.openGraph.type && (
                        <div class="live-card">
                          <p class="live-label">OG type</p>
                          <p class="live-value">{liveMetadata.openGraph.type}</p>
                        </div>
                      )}
                      {liveMetadata.openGraph.siteName && (
                        <div class="live-card">
                          <p class="live-label">Site name</p>
                          <p class="live-value">{liveMetadata.openGraph.siteName}</p>
                        </div>
                      )}
                      {liveMetadata.openGraph.image && (
                        <div class="live-card live-card-image">
                          <p class="live-label">OG image</p>
                          <img src={liveMetadata.openGraph.image} alt={`${tool.title} Open Graph image`} loading="lazy" />
                        </div>
                      )}
                    </div>
                  </article>
                )}

                {hasBrandMetadata && liveMetadata && (
                  <article class="live-group">
                    <p class="live-group-label">Contact & brand</p>
                    <div class="live-card-grid">
                      {(liveMetadata.brand.author || liveMetadata.brand.twitterHandle) && (
                        <div class="live-card">
                          <p class="live-label">Brand details</p>
                          <ul class="list-pills">
                            {liveMetadata.brand.author && <li>{liveMetadata.brand.author}</li>}
                            {liveMetadata.brand.twitterHandle && <li>{liveMetadata.brand.twitterHandle}</li>}
                          </ul>
                        </div>
                      )}
                      {liveMetadata.brand.emails.length > 0 && (
                        <div class="live-card">
                          <p class="live-label">Email</p>
                          <ul class="list-pills">
                            {liveMetadata.brand.emails.map((email: string) => (
                              <li><a href={`mailto:${email}`} class="live-link">{email}</a></li>
                            ))}
                          </ul>
                        </div>
                      )}
                      {liveMetadata.brand.phones.length > 0 && (
                        <div class="live-card">
                          <p class="live-label">Phone</p>
                          <ul class="list-pills">
                            {liveMetadata.brand.phones.map((phone: string) => (
                              <li><a href={`tel:${phone}`} class="live-link">{phone}</a></li>
                            ))}
                          </ul>
                        </div>
                      )}
                      {liveMetadata.brand.contactUrls.length > 0 && (
                        <div class="live-card">
                          <p class="live-label">Contact links</p>
                          <ul class="list-pills">
                            {liveMetadata.brand.contactUrls.map((link: string) => (
                              <li><a href={link} target="_blank" rel="noopener noreferrer" class="live-link">{extractDomain(link) || link}</a></li>
                            ))}
                          </ul>
                        </div>
                      )}
                    </div>
                  </article>
                )}

              </div>
            </section>
          )}

          <div class="tool-detail-share">
            <h3 class="share-title">Share this tool</h3>
            <div class="share-buttons">
              <a href={`https://twitter.com/intent/tweet?text=Check out ${tool.title} - ${tool.body}&url=${canonicalUrl}&via=planetabhi`} target="_blank" rel="noopener noreferrer" class="share-btn" title="Share on Twitter" aria-label="Share on Twitter">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2s9 5 20 5a9.5 9.5 0 00-9-5.5c4.75 2.25 9-1 9-5.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z"/></svg>
              </a>
              <a href={`https://www.linkedin.com/sharing/share-offsite/?url=${canonicalUrl}`} target="_blank" rel="noopener noreferrer" class="share-btn" title="Share on LinkedIn" aria-label="Share on LinkedIn">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"/><circle cx="4" cy="4" r="2"/></svg>
              </a>
              <a href={`https://reddit.com/submit?url=${canonicalUrl}&title=${tool.title}: ${tool.body}`} target="_blank" rel="noopener noreferrer" class="share-btn" title="Share on Reddit" aria-label="Share on Reddit">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/><path d="M8 12a1 1 0 11-2 0 1 1 0 012 0zm6 0a1 1 0 11-2 0 1 1 0 012 0z" fill="white"/><path d="M12 15c-1.5 0-2.5.5-3 1" stroke="white" stroke-width="2"/></svg>
              </a>
              <button class="share-btn" id="copyLinkBtn" title="Copy link to clipboard" aria-label="Copy link to clipboard">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
              </button>
            </div>
          </div>

          <div class="tool-detail-nav">
            <a href={category === 'all' ? '/' : `/${category}`} class="nav-link">‚Üê Back to {category === 'all' ? 'all' : category}</a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script type="module">
    (function () {
      const modalEl = document.getElementById('toolModal');
      const fallbackNavigateTo = modalEl?.dataset.fallback || '/';
      const hasSameOriginReferrer = (() => {
        try {
          if (!document.referrer) return false;
          const ref = new URL(document.referrer);
          return ref.origin === window.location.origin;
        } catch {
          return false;
        }
      })();

      function closeModal() {
        // remove modal marker before navigating back
        document.body.removeAttribute('data-modal-open');
        document.body.style.overflow = '';
        if (hasSameOriginReferrer && window.history.length > 1) {
          window.history.back();
        } else {
          window.location.href = fallbackNavigateTo;
        }
      }

      // Delegate clicks for close, backdrop, and copy
      document.addEventListener('click', (e) => {
        const close = e.target.closest('.tool-detail-close-btn');
        if (close) return closeModal();

        // If clicked outside the modal but inside backdrop
        const backdrop = e.target.closest('.tool-detail-modal-backdrop');
        const modal = e.target.closest('.tool-detail-modal');
        if (backdrop && !modal) return closeModal();

        const copyBtn = e.target.closest('#copyLinkBtn');
        if (copyBtn) {
          const url = window.location.href;
          navigator.clipboard.writeText(url).then(() => {
            const original = copyBtn.innerHTML;
            copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg>';
            copyBtn.title = 'Copied!';
            setTimeout(() => {
              copyBtn.innerHTML = original;
              copyBtn.title = 'Copy link to clipboard';
            }, 2000);
          });
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
      });

      // Mark that modal is open so we can hide background elements (title/description)
      document.body.setAttribute('data-modal-open', 'true');
      // Prevent background scroll while modal open
      document.body.style.overflow = 'hidden';

      // Ensure state cleanup on page hide/unload
      window.addEventListener('pagehide', () => {
        document.body.removeAttribute('data-modal-open');
        document.body.style.overflow = '';
      });
      window.addEventListener('unload', () => {
        document.body.removeAttribute('data-modal-open');
        document.body.style.overflow = '';
      });
    })();
  </script>

  <style is:global>
    /* Inherit fonts and base styles from Layout and foundations */
    /* When a modal detail page is open, hide the page title + description behind it */
    body[data-modal-open="true"] .title,
    body[data-modal-open="true"] .description-text {
      opacity: 0 !important;
      visibility: hidden !important;
      pointer-events: none !important;
      transition: opacity 120ms ease;
    }
  </style>

  <style scoped>
    .tool-detail-modal-backdrop {
      position: fixed;
      inset: 0;
      background-color: rgba(0,0,0,0.88);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000000;
      padding: var(--spacing-05);
      overflow-y: auto;
    }

    .tool-detail-modal {
      background-color: var(--background-secondary);
      border-radius: var(--spacing-03);
      width: 100%;
      max-width: 680px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      padding: var(--spacing-09);
      background-color: var(--background-secondary);
      --shadow-color: rgb(0 0 0 / 0.04);
      box-shadow:
        0px 0px 0px 0.5px var(--background-selected),
        0px 1px 1px -0.5px var(--shadow-color),
        0px 3px 3px -1.5px var(--shadow-color),
        0px 12px 12px -6px var(--shadow-color);
      content-visibility: auto;
      contain-intrinsic-size: 8.5rem;
      transition: box-shadow 0.2s ease-out;
    }

    .tool-detail-close-btn { position: absolute; top: var(--spacing-06); right: var(--spacing-06); background: none; border: none; cursor: pointer; color: var(--content-secondary); width: var(--spacing-09); height: var(--spacing-09); display:flex; align-items:center; justify-content:center; border-radius:var(--spacing-02); }
    .tool-detail-close-btn:hover { background-color: var(--background-secondary); color: var(--content-primary); }

    .tool-detail-header { display:flex; gap: var(--spacing-05); align-items:flex-start; margin-bottom: var(--spacing-09); }
    .tool-icon { width:64px; height:64px; border-radius: var(--spacing-02); background-color: var(--background-secondary); border: 1px solid var(--border-muted); }
    .tool-title { margin:0; font-size: var(--desktop-h4); color: var(--content-primary); }
    .tool-domain { margin:0; color: var(--content-secondary-alt); }

    .tool-detail-content { display:flex; flex-direction:column; gap: var(--spacing-08); }
    .tool-summary { display:flex; flex-direction:column; gap: var(--spacing-03); padding: var(--spacing-05); background-color: var(--background-secondary); border-radius: var(--spacing-02); border: 1px solid var(--border-muted); }
    .tool-description { margin:0; color: var(--content-primary); }
    .summary-meta { display:flex; flex-direction:column; gap: var(--spacing-01); }
    .summary-label { font-size: var(--desktop-caption); color: var(--content-secondary-alt); text-transform: uppercase; }
    .summary-value { color: var(--accent); text-decoration:none; font-weight:600; }
    .summary-value:hover { text-decoration:underline; }
    .summary-value--muted { color: var(--content-secondary); text-decoration:none; }

    .tool-section { display:flex; flex-direction:column; gap: var(--spacing-05); padding: var(--spacing-06); border: 1px solid var(--border-muted); border-radius: var(--spacing-03); background-color: var(--background-primary, var(--background-secondary)); }
    .section-header { display:flex; gap: var(--spacing-05); align-items:flex-start; }
    .section-eyebrow { margin:0; font-size: var(--desktop-caption); color: var(--content-secondary-alt); text-transform: uppercase; letter-spacing: 0.08em; }
    .section-title { margin:0; font-size: var(--desktop-h5); color: var(--content-primary); }
    .section-subtitle { margin: var(--spacing-01) 0 0 0; color: var(--content-secondary); }

    .snapshot-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: var(--spacing-04); }
    .snapshot-card { padding: var(--spacing-04); border-radius: var(--spacing-02); background-color: var(--background-secondary); border:1px solid var(--border-muted); display:flex; flex-direction:column; gap: var(--spacing-01); }
    .snapshot-label { margin:0; font-size: var(--desktop-caption); color: var(--content-secondary-alt); text-transform: uppercase; }
    .snapshot-value { margin:0; color: var(--content-primary); font-weight:600; }
    .snapshot-value--muted { color: var(--content-secondary); font-weight:500; }
    .category-link { color: var(--accent); text-decoration:none; }
    .category-link:hover { text-decoration:underline; }
    .link-muted { color: var(--content-secondary); text-decoration:none; }
    .link-muted:hover { color: var(--accent); }

    .tool-detail-actions { display:flex; flex-direction:column; gap: var(--spacing-02); }
    .btn-primary { display:inline-block; padding: var(--spacing-04) var(--spacing-05); background-color: var(--accent); color:white; border-radius: var(--spacing-02); text-decoration:none; font-weight:600; text-align:center; }
    .btn-primary:hover { filter: brightness(1.05); }
    .btn-disabled { opacity: 0.5; cursor: not-allowed; pointer-events:none; }
    .action-hint { margin:0; color: var(--content-secondary); font-size: var(--desktop-caption); }

    .live-section { background-color: var(--background-secondary); border-color: var(--border-muted); }
    .live-metadata-grid { display:flex; flex-direction:column; gap: var(--spacing-05); }
    .live-group { border:1px solid var(--border-muted); border-radius: var(--spacing-03); padding: var(--spacing-05); background-color: var(--background-primary, var(--background-secondary)); }
    .live-group-label { margin:0 0 var(--spacing-03) 0; font-size: var(--desktop-caption); color: var(--content-secondary-alt); text-transform: uppercase; letter-spacing:0.08em; }
    .live-card-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(190px, 1fr)); gap: var(--spacing-04); }
    .live-card { padding: var(--spacing-04); border-radius: var(--spacing-02); background-color: var(--background-secondary); border: 1px solid var(--border-muted); display:flex; flex-direction:column; gap: var(--spacing-02); }
    .live-card-inline .favicon-preview { display:flex; align-items:center; gap: var(--spacing-03); }
    .live-card-image img { width:100%; border-radius: var(--spacing-02); border:1px solid var(--border-muted); object-fit:cover; }
    .live-label { margin:0; font-size: var(--desktop-caption); text-transform: uppercase; color: var(--content-secondary-alt); }
    .live-value { margin:0; color: var(--content-primary); font-weight:500; }
    .live-link { color: var(--accent); word-break: break-all; text-decoration:none; }
    .live-link:hover { text-decoration:underline; }
    .favicon-preview img { border-radius: var(--spacing-02); border:1px solid var(--border-muted); }
    .list-pills { list-style:none; padding:0; margin:0; display:flex; flex-wrap:wrap; gap: var(--spacing-02); }
    .list-pills li { background-color: var(--background-secondary); border-radius: var(--spacing-02); padding: 2px var(--spacing-03); font-size: var(--desktop-caption); color: var(--content-secondary); }

    .share-buttons { display:flex; gap: var(--spacing-03); }
    .share-btn { width:40px; height:40px; display:flex; align-items:center; justify-content:center; border-radius: var(--spacing-02); background-color: var(--background-secondary); border:1px solid var(--border-muted); color:var(--content-secondary); }
    .share-btn:hover { color: var(--accent); border-color: var(--accent); }

    .tool-detail-nav { padding-top: var(--spacing-05); border-top: 1px solid var(--border-muted); display:flex; gap: var(--spacing-03); }
    .nav-link { color: var(--content-secondary); }
    .share-title{ color: var(--content-secondary); font-size: var(--desktop-caption); text-transform: uppercase; }

    @media (max-width: 768px) {
      .tool-detail-modal { padding: var(--spacing-06); margin: var(--spacing-05); }
      .tool-icon { width:48px; height:48px }
      .section-header { flex-direction:column; }
      .tool-section { padding: var(--spacing-05); }
    }
  </style>

</Layout>
